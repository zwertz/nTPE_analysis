# nTPE_analysis
A structure for extracting experimental observables for the SBS GMn and nTPE experiments from data taken in 2021 and 2022. The primary the experimental observable is Rsf (or R_sf^np), which is the relative neutron to proton scale factor ratio as determined by fitting and comparing data and Monte Carlo (MC) delta x (or dx) distributions. The determination of Rsf (or R_sf^np) is made by the data_mc_compare.C in the analysis/gmn_ntpe directory. For the first stage of extracting physics observables one also needs to calculate the ratio of quasi-elastic neutron to proton cross-sections, as determined by the simulation. This calculation of the ratio of quasi-elastic neutron to proton cross-sections is handled by calc_FFs_RCS_obj.h/C, located in include/ and src/ respectively. The information about the cross-section ratio, as present in the MC, is available in the output of the data_mc_compare.C script. The input to the data_mc_compare script are parsed data and MC root files.

Most of the up-to-date analysis in this framework is controlled by config files which are present in the directory config/ and the relevant subdirectories. These config files are supported by the parse_config class files which are located in include/ and src/ respectively. Similarly, any features (classes or functions) which are used throughout the analysis framework are stored in include/ and src/, one will need to reference the individual files to better understand their purpose. The config files handled both relevant input/output information, configurations of the analysis, and cut variables. As well as any other user-configurable info.

The first major step of the analysis is to process replayed data files or digitized replayed MC files, for a given SBS kinematic and magnetic field setting, with the respective parser script. This is either data_elastic_parse or mc_parse, both of which are located in the analysis/gmn_ntpe directory. Both parsers should complete equivalent analyses or processes of the data and MC events. Both parsers should create an analysis root tree and diagnostic or later analysis flow histograms. The parser scripts should run fine on the JLab interactive farm, batch farm capabilities need to be tested. The parsed files are used for higher level analysis tasks which will be described directly.

This analysis structure also allows for other studies of cut variable stability and systematics, HCal detection efficiency and non-uniformity, and background shape and systematic. All of these tasks will take in either parsed analysis trees or higher order analysis files. In an ideal workflow one would want to determine optimized cut variable regions with the stability_study script, which is present in the analysis/gmn_ntpe directory. The script has two modes, one which will take narrow slices of a given cut variable and is used to define the cut region, and a seconde mode which takes larger regions of the cut variable and varying a particular cut boundary. To see how the variation of the cut boundary systematically effects the primary experimental observable. The output stability study plots guide the user and the cut regions should be fedback into the relevant configuration file scripts to reparse both data and MC files if necessary. HCal detection efficiency non-uniformity is completed by the data or MC scripts HCal_p_Eff_uniformity_data/_MC, in the analysis/hcal_eff directory, which will produce 1D and 2D distributions for HCal position-dependent relative rates which can be used to characterize non-uniformities and acceptance-averaged efficiencies for lower-Q^2 kinematics (SBS4,SBS8, SBS9). The HCal_p_Eff_uniformity_data/_MC script is completed for a particular kinematic and SBS magnet field setting. To consider an entire map over multiple SBS magnet field setting for a single kinematic use the HCal_Eff_map script. To compare HCal position-dependent rates for both LH2 and LD2 from either data or MC files one can use the HCal_Eff_map_compare script. The efficiency map as well as the acceptance-averaged efficiency value is fedback into the relevant configuration files and used to reprocess the parsing of the MC files. Currently varying the shape of the background and acquiring multiple values of Rsf to complete the systematic is handled by the data_mc_compare script. In principle, one could create a separate script for the background systematic and to just compare the data and MC delta x distributions. 

Once Rsf values are determined for the relevant kinematics these values are used as input in a separate spreadsheet to determine physics results of form factor values and uncertainties. The world data directory is legacy information from John Boyd and was not really adapted for this analysis. I simply have not yet seen a reason to remove it. The world_data_plot directory has scripts to create elegant plots of GMN and nTPE results similiar to the format in 50 Years of QCD and based off of values in my thesis. 

In general I have attempted to capture the big picture features of this analysis framework, refer to each file for details (documentation) about the script function. In general more information about the analysis can also be found in my thesis: https://misportal.jlab.org/sti/publications/25315
